{% extends "base.html" %}
{% load static %}

{% block title %}Create Thread{% endblock %}

{% block link %}
<!-- Martor Editor Styles -->
<link href="{% static 'plugins/css/ace.min.css' %}" type="text/css" media="all" rel="stylesheet" />
<link href="{% static 'martor/css/martor.bootstrap.min.css' %}" type="text/css" media="all" rel="stylesheet" />
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
  <div class="card bg-base-200 shadow-xl">
    <div class="card-body">
      <h2 class="card-title text-3xl mb-4">Create New Thread</h2>
      <p class="text-base-content/70 mb-6">Start a new discussion and engage with the community</p>
      
      <form method="post" class="space-y-6">
        {% csrf_token %}
        
        <!-- Title Field -->
        <div class="form-control w-full">
          <label class="label">
            <span class="label-text font-semibold">Thread Title</span>
            <span class="label-text-alt text-error">*</span>
          </label><input 
            type="text" 
            name="title" 
            placeholder="Enter a descriptive title for your thread" 
            class="input input-bordered w-full focus:input-primary" 
            required
            maxlength="200"
          /> 

          <label class="label">
            <span class="label-text-alt">Maximum 200 characters</span>
          </label>
        </div>

        
        <!-- Content Field -->
        <div class="form-control w-full">
          <label class="label">
            <span class="label-text font-semibold">Content</span>
            <span class="label-text-alt text-error">*</span>
          </label>
        <textarea id="markdown-editor" name="content"  placeholder="Add the content"  class="input input-bordered w-full focus:input-primary"required maxlength="200" rows="2">
          </textarea>
          <label class="label">
            <span class="label-text-alt">Share your thoughts, questions, or ideas</span>
          </label>
        </div>
        <!-- Category Field -->
        <div class="form-control w-full">
          <label class="label">
            <span class="label-text font-semibold">Category</span>
          </label>
          <select name="category" class="select select-bordered w-full focus:select-primary" required>
            <option value="">Select a category</option>
            {% for category in categories %}
            <option value="{{ category.id }}">{{ category.name }}</option>
            {% endfor %}
          </select>
          <label class="label">
            <span class="label-text-alt">Choose a category to help organize your thread</span>
          </label>
        </div>

           <!-- Tags Field -->
        <div class="form-control">
  <label class="label">
    <span class="label-text font-semibold">Tags</span>
  </label>

  <!-- Hidden input that Django reads -->
  <input type="hidden" name="tags" id="tags-input">

  <!-- Tag buttons -->
  <div class="flex flex-wrap gap-2" id="tag-container">
    <button type="button" class="btn btn-outline btn-sm tag-btn" data-tag="midsem">#midsem</button>
    <button type="button" class="btn btn-outline btn-sm tag-btn" data-tag="quiz">#quiz</button>
    <button type="button" class="btn btn-outline btn-sm tag-btn" data-tag="urgent">#urgent</button>
    <button type="button" class="btn btn-outline btn-sm tag-btn" data-tag="notes">#notes</button>
    <button type="button" class="btn btn-outline btn-sm tag-btn" data-tag="assignment">#assignment</button>
  </div>
</div>

        <!-- Locked Thread Option -->
        <div class="form-control">
          <label class="label cursor-pointer justify-start gap-3">
            <input 
              type="checkbox" 
              name="locked" 
              class="checkbox checkbox-primary"
            />
            <div>
              <span class="label-text font-semibold">Lock Thread</span>
              <span class="label-text-alt block">Prevent new replies to this thread</span>
            </div>
          </label>
        </div>

        <!-- Form Actions -->
        <div class="card-actions justify-end pt-4">
          <a href="{% url 'forum-home' %}" class="btn btn-ghost">Cancel</a>
          <button type="submit" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            Create Thread
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  <script type="text/javascript" src="{% static 'plugins/js/ace.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/mode-markdown.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/ext-language_tools.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/theme-github.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/typo.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/spellcheck.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/highlight.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/emojis.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'martor/js/martor.bootstrap.min.js' %}"></script>
  <script>
  const selectedTags = new Set();
  const tagInput = document.getElementById("tags-input");

  document.querySelectorAll(".tag-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const tag = btn.dataset.tag;

      if (selectedTags.has(tag)) {
        selectedTags.delete(tag);
        btn.classList.remove("btn-primary");
        btn.classList.add("btn-outline");
      } else {
        selectedTags.add(tag);
        btn.classList.remove("btn-outline");
        btn.classList.add("btn-primary");
      }

      tagInput.value = Array.from(selectedTags).join(",");
    });
  });
</script>

<script>
  var easyMDE = new EasyMDE({
      element: document.getElementById("markdown-editor"),
      spellChecker: false,
      autosave: {
          enabled: true,
          uniqueId: "post-editor"
      }
  });
</script>


{% endblock %}
